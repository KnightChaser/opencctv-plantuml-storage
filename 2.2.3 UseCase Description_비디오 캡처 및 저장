• 유스케이스명: 비디오 캡처 및 저장
• 유스케이스 ID : UC03
• 액터명: CCTV 디바이스(CCTVDevice)
• 유스케이스 개요: CCTV 디바이스는 libcamera 또는 FFmpeg를 이용하여 실시간 영상을 캡처하고, 이를 H.264로 인코딩한 후, SSD/SD카드에 순환 버퍼 형태로 저장한다.
• 사전 조건:
CCTV는 전원 및 카메라 모듈이 정상적으로 연결된 상태여야 한다.
저장 장치가 마운트되어 있고 파일 시스템이 읽기/쓰기가 가능한 상태여야 한다.
• 이벤트 흐름
- 정상 흐름
CCTV 장치는 부팅 후 libcamera를 통해 카메라 디바이스를 초기화한다.
지정된 해상도(기본: 1080p@30fps)로 실시간 영상 캡처를 시작한다.
캡처된 비디오 스트림은 하드웨어 가속 기반의 H.264로 인코딩된다.
인코딩된 영상은 60초 단위 세그먼트로 분할된다.
세그먼트는 SSD 또는 SD카드에 circular buffer 구조로 저장된다.
저장 공간이 가득 차면 오래된 세그먼트부터 LRU 방식으로 삭제된다.
- 선택 흐름:
사용자가 4K@15fps로 설정한 경우, 시스템은 성능을 고려하여 frame rate 및 GOP 설정을 자동 조절한다.
- 예외 흐름:
libcamera 초기화 실패 시, 시스템은 FFmpeg로 자동 failover 시도 후 캡처를 계속 진행한다.
Disk I/O 실패 발생 시 최대 5회 exponential backoff로 재시도 후, Prometheus에 오류 메트릭 기록 및 관리자 알림을 전송한다.
